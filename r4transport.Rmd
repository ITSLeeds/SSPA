---
title: "R for Spatial Planning and Analysis"
author: "Robin Lovelace"
date: "`r Sys.Date()` Week 17. For TRAN5015."
output: 
  html_document: 
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

## Context: Sustainable Spatial Planning and Analysis

- From AAARRRRGGGGGH to R Getting your hands dirty with data
- Reproducing the analysis done for Harrogate data with R ()
- Practical calculating accessibility measures in R and QGIS and visualising the results (bonus)

Requirements: students are recommended to have the latest versions of R, RStudio and QGIS installed on their computers.

Learning outcomes: students will learn how to download and visualise spatial data with R

## Datasets

- Reproducible approach will be used, starting from the data
- OpenStreetMap data on roads
- Census OD data on movement patterns

# From AAARGH to R

## Setting up a project

# Reproducing what we did with QGIS

## Data access

First, we must ensure that the data used for the QGIS tutorial is in your working directory.

You could just look at the Files tab in the bottom left of your RStudio instance to do this:


```{r, echo=FALSE}
knitr::include_graphics("figures/rstudio-data.png")
```

You can also do the programmatically, but entering the following command:

```{r}
list.dirs(recursive = FALSE)
```

What just happened?

We asked R to list all the directories in the working directory. Note that the output is printed to screen, and into this tutorial. The one we're interested in is element number 5:

```
[5] "./QGISforSSPAdata
```

This exercise demonstrates the difference between a graphical user interface and doing things programmatically. Both work. But the programming way is more precise, but potentially more confusing if you're new to R.

### Challenge

1. Look inside the QGISforSSPAdata folder. Count how many files and folders are in there manually.

2. Now automate the process using the function `list.files()` - what is the output? Do the numbers match?

Note: this is the output you should get from the previous command:

```{r, echo=FALSE}
list.files(path = "QGISforSSPAdata/")
```

## Reading data

We'll use the **sf** package to read the data.

To install the package, use the following command:

```{r, eval=FALSE}
install.packages("sf")
```

To make the functions available from the package we've just installed, use the `library` function, as follows:

```{r}
library(sf)
```

Now we can use the new powers enabled by this package, like reading in a shapefile:

```{r}
stns = st_read("QGISforSSPAdata/stations UK/station_point.shp")
```

Note that the information printed to screen when you read this file in is useful. It tells you the data format (ESRI Shapefile), the number of features (2,525 output areas) and the coordinate reference system (CRS): the `+units=m` part of the output tells you that units of this CRS is meters.

Now that the data has been loaded into an R object, `stns`, we can query and analyse the data.
To provide a simple example, find out the names of the variables in the object, using the `names()` function as follows:

```{r}
names(stns)
```

The result tells us that there are 4 variables stored in the object (one of these, `geometry` is not really a data attribute but a geographical attribute so the data has 3 variables or `fields`).

The data can be plotted as follows:

```{r}
plot(stns)
```

Note that three versions of the dataset are plotted: one for each variable contained in the `stns` object.
These can be seen with the following command:

```{r}
head(stns)
```

### Challenge: read and plot Harrogate data

1. Find the file Harrogate OAC layer on your computer and load it into an object called `harrogate_oac` using the function `st_read()`.

```{r, echo=FALSE, results='hide'}
harrogate_oac = st_read("QGISforSSPAdata/Harrogate OAC/Harrogate.shp")
```

2. Explore the results using the `names()`, `plot()`, and `head()` commands. How many variables does the object `harrogate_aoc` have?

```{r, echo=FALSE}
names(harrogate_oac)
```



## Subsetting data

# Calculating accessibility measures



