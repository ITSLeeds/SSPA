---
title: "Software for Sustainable Planning"
author: "Robin Lovelace"
date: 'University of Leeds, `r Sys.Date()`<br/><img class="img-footer" alt="" src="http://www.stephanehess.me.uk/images/picture3.png">'
output:
  xaringan::moon_reader:
    # css: ["default", "its.css"]
    # chakra: libs/remark-latest.min.js
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
bibliography: references.bib
---

background-image: url(https://c1.staticflickr.com/2/1216/1096671706_571a263b63_b.jpg)
background-position: 50% 50%
class: center, bottom, inverse

```{r setup, include=FALSE}
# system("wget https://github.com/ITSLeeds/TDS/raw/master/courses/references.bib")
options(htmltools.dir.version = FALSE)
library(RefManageR)
library(dplyr)
BibOptions(check.entries = FALSE, 
           bib.style = "authoryear", 
           cite.style = 'alphabetic', 
           style = "markdown",
           first.inits = FALSE,
           hyperlink = FALSE, 
           dashed = FALSE)
my_bib = ReadBib("references.bib", check = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

---

# This lecture will...

- Provide a recap on what accessibility indicators are and how to build them

--

- Outline different 'tools of the trade' for transport planning, with a focus on QGIS

--

- Talk about a few transport-related tools

--

- Prepare you for the practical workshop

---

# Context

- Indicators are an important tool to support sustainable transport policies

- See here for slides on building an indicator: https://rpubs.com/RobinLovelace/475813

- For your coursework you will describe an indicator at

- E.g. estimated proximity to green space from zones

  - Can add layers: distance to green space *away from major roads*

  - proximity to green space *away from major roads and with public transport connections*

  - proximity to green space *away from major roads and with public transport connections and cycle infrastructure*
  
```{r, eval=FALSE, echo=FALSE}
library(geofabrik)
parks_leeds = get_geofabrik(name = "west yorkshire", layer = "multipolygons", key = "leisure", value = "park")
sf:::plot.sfg(sf::st_geometry(parks_leeds))
```

---

# First step in indicator project...

--

![](https://user-images.githubusercontent.com/1825120/75754674-06f34200-5d25-11ea-84a0-283409b54fc3.gif)

Get the data!



---

background-image: url()
background-size: cover
class: center, middle

# GUIs vs CLIs

---

# First up: what are GUIs and CLIs?


.pull-left[

Gooeys:

```{r, out.width="100%", echo=FALSE}
knitr::include_graphics("https://du7ybees82p4m.cloudfront.net/57c6a159cf4a79.53834822.jpg?width=1820&height=1023")

```

Informally: pointy-clicky-programs

Formally: a form of user interface that allows users to interact with electronic devices through graphical icons 

]

--

.pull-right[

```{r guigif, echo=FALSE}
knitr::include_graphics("https://user-images.githubusercontent.com/1825120/44630441-adeb6680-a955-11e8-978a-62ddf94eb5c7.gif")
```

]

---

## A comparison of CLIs vs GUIs

```{r clitable, echo=FALSE, out.width="100%"}
knitr::include_graphics("https://cdn-images-1.medium.com/max/1600/1*oLc-KPfL-OUHqKiQsn7q4g.png")
```

---

## In the context of geographic data

```{r, message=FALSE}
u = "https://github.com/Robinlovelace/geocompr/raw/master/extdata/gis-vs-gds-table.csv"
d = readr::read_csv(u)
knitr::kable(x = d, format = "html")
```

Source: Geocomputation with R `r Citep(my_bib, "lovelace_geocomputation_2018", .opts = list(cite.style = "authoryear"))`

---

## Why is reproducibility important?

--

- Because it's more likely to get you published in scientific journals
- Because reproducible research is more likely to be built-on and referenced

--

- A more in-depth reason:

> A process in which the same results can be generated by others using publicly accessible code.

> This may sound simple and easy to achieve (which it is if you carefully maintain your R code in script files), but has profound implications for teaching and the scientific process
`r Citep(my_bib, "pebesma_r_2012", .opts = list(cite.style = "authoryear"))`

---

## Scriptable vs methodological reproducibility

.pull-left[

Full reproducibility means providing a formal recipe, in the form a 'script' containing computer code.

For many transport planners this is not feasible.

But that does not mean you cannot make your work reproducible.

Think of a cooking recipe

]

--

.pull-right[

![](https://imgs.xkcd.com/comics/learning_to_cook.png)

]


---

## CLI vs GUI vs NUI

- There are other ways of interactive with computers!

```{r nuis, echo=FALSE, out.width="100%"}
knitr::include_graphics("https://www.researchgate.net/profile/Martin_Molina4/publication/304816895/figure/fig5/AS:667910355816460@1536253646575/The-User-Interface-evolution-Command-line-interfaces-began-the-UI-revolution-followed-by.jpg")
```

Source: `r Citep(my_bib, "fernandez_natural_2016", .opts = list(cite.style = "authoryear"))` 

---

## CLIs can be confusing

For example: 

> The general syntax of a GRASS
command which is called to run a module is similar to UNIX commands:

```
module [-flag1[flag2...]] parameter1=map1[,map2,...]\
[parameter2=number...] [--o] [--q] [--v]
```
`r Citep(my_bib, "neteler_open_2008", .opts = list(cite.style = "authoryear"))` 

---

## Learning to use a CLI

- Takes time and practice

- Benefits massively from touch typing 

- See Efficient R Programming, Section [1.5](https://csgillespie.github.io/efficientR/introduction.html#cross-transferable-skills-for-efficiency) `r Citep(my_bib, "gillespie_efficient_2016", .opts = list(cite.style = "authoryear"))` 

![](https://csgillespie.github.io/efficientR/figures/f1_1_800px-QWERTY-home-keys-position.png)

---

## Live example

Coffee data in a GUI vs a CLI

.pull-left[

In a GUI:

![](https://user-images.githubusercontent.com/1825120/52374114-5dc01680-2a54-11e9-9b0a-11a345fe9767.gif)

]

--

.pull-right[
![](https://user-images.githubusercontent.com/1825120/52374960-74676d00-2a56-11e9-95e2-19d1c39365b8.gif)
]

---

### Which tool to use?

There are many options, so an important (but not vital) thing is

> using the best tool for the job (Source: [Rachel Tatman](https://twitter.com/rctatman/status/1080884427373273088))

![](https://pbs.twimg.com/media/DwARvLCUcAERrqw.jpg)

---

## QGIS in action


<iframe width="560" height="315" src="https://www.youtube.com/embed/cNxCcZyouhs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

You can do LOTS with QGIS and it's getting more powerful every month

---

## Current transport software

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tms = readr::read_csv("https://github.com/ITSLeeds/TDS/raw/master/transport-software.csv")[1:5]
tms = dplyr::arrange(tms, dplyr::desc(Citations))
knitr::kable(tms, booktabs = TRUE, caption = "Sample of transport modelling software in use by practitioners. Note: citation counts based on searches for company/developer name, the product name and 'transport'. Data source: Google Scholar searches, October 2018.", format = "html")
```

---

## OSMnx

```{r, engine='python', eval=FALSE}
import networkx as nx
import osmnx as ox
import requests
import matplotlib.cm as cm
import matplotlib.colors as colors
# after fixing a couple of issues, e.g. with https://github.com/gboeing/osmnx/issues/45 and:
# Error in py_call_impl(callable, dots$args, dots$keywords) : 
#   ImportError: Something is wrong with the numpy installation. While importing we detected an older version of numpy in ['/home/robin/.local/lib/python3.6/site-packages/numpy']. One method of fixing this is to repeatedly uninstall numpy until none is found, then reinstall this version. 
# ... I can do this:
G = ox.graph_from_place('bangor', network_type='drive')
ox.plot_graph(ox.project_graph(G)) # note this was sloooow!
```

![](https://user-images.githubusercontent.com/1825120/52378130-ca401300-2a5e-11e9-90be-0ec12d075c9d.png)

---

## Features of osmnx

- Based on OSM street networks
- Functions to correct/simplify street topology
- Many street network measures implemented
- Can do routing
- More info, see the paper 
`r Citep(my_bib, "boeing_osmnx_2017", .opts = list(cite.style = "authoryear"))` 

---

## Features of stplanr

- Designed after creating functions for the pct.bike project
- Focus on origin-destinatioin data
- Also handles route networks and local routing (work in progress)
- An assortment of other functions
- Has since let to 2 other packages:
  - cyclestreets (for accessing cyclestreets.net data)
  - stats19 for accessing crash data
- More info, see the stplanr paper, or ask the author ;) `r Citep(my_bib, "lovelace_stplanr_2017", .opts = list(cite.style = "authoryear"))` 

---

## In R / stplanr

```{r netr}
library(sf)
# net = dodgr::dodgr_streetnet("bangor")
library(osmdata)
net = opq("bangor") %>% 
  add_osm_feature("highway") %>% 
  osmdata_sf()
```


---

## In QGIS

![](https://user-images.githubusercontent.com/1825120/75730875-06878680-5ce6-11ea-8744-65c4c3915888.gif)

---

## How to go from GIS analysis to indicator? 

- Example: the Propensity to Cycle Tool ([PCT.bike](http://www.pct.bike/)) (Lovelace et al. 2017)

```{r, echo=FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/npct/pct-team/master/figures/early.png")
```

---

## Advantages of QGIS

--

Interactive

--

Popular

--

Intuitive

--

Shallow learning curve

--

Works well with visual learning style

--

### What you need for the workshop

- A working version of QGIS

  - On your laptop (recommended if you have a decent laptop)
  - Or on the University of Leeds computers 
  
- Always...

--

  - Save your work

---

## Preparation for QGIS Workshop

![](https://itsleeds.github.io/QGIS-intro/figures/QGISGUI.jpg)
See [itsleeds.github.io/QGIS-intro](https://itsleeds.github.io/QGIS-intro)

---

# Online communities

- [gis.stackexchange.com](https://gis.stackexchange.com/questions) has 21,314 questions 

- [r-sig-geo](http://r-sig-geo.2731867.n2.nabble.com/) has 1000s of posts

- RStudio's Discourse community has 65,000+ posts already!

--

- No transport equivalent (e.g. earthscience.stackexchange.com is in beta)

- Potential for a Discourse forum or similar: transport is not (just) GIS

---

# References

```{r, 'refs', results="asis", echo=FALSE}
PrintBibliography(my_bib)
# RefManageR::WriteBib(my_bib, "refs-geostat.bib")
```
